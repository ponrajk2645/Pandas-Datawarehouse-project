# quering products table using sql query
sql = "select * from product"
try:
    result = pd.read_sql(sql,engine)
    print(result)
except Exception as e:
    print(f"ERROR:{e}")

# analyse required information using sql join query 
sql1 = """select 
    o.order_id, 
    o.order_date,
    o.customer_id,
    o.product_id, 
    c.customer_name,
    p.product_name,
    sum(p.price) over(partition by customer_id order by customer_id rows between unbounded preceding and current row) as total,
    count(order_id) over () as total_rows
from orders o 
join customers c on o.customer_id = c.customer_id
join products p on o.product_id = p.product_id"""
try:
    result = pd.read_sql(sql1,engine)
    print(result)
except Exception as e:
    print(f"ERROR:{e}")

# execute sql query
try: 
    connection = engine.connect()
    sql = "select * from products"
    result = connection.execute(text(sql))
    for row in result:
        print(row)
except Eception as e:
    print(F "ERROR:{E}") 

finally:
    connection.commit()
